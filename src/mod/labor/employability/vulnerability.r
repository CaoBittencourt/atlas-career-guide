# region: imports
box::use(
  mod / labor / employability / misc / Omega[...],
  stats[weighted.mean]
)

# endregion
# region: vulnerability
# vulnerability = á¹½s_k with u_qk := 1 for all q,k (i.e. max vulnerability)
vulnerability <- function(T_q, h_q, ttc, w, agg = T) {
  if (is.function(ttc)) {
    list(ttc) -> ttc
  }

  # vulnerability in infinitely stratified labor market
  h_q * Omega(0, T_q, ttc) -> vutilde

  # aggregate vulnerability
  if (agg) {
    weighted.mean(
      x = vutilde,
      w = w
    ) -> vutilde
  }

  # vulnerability
  return(vutilde)
}

# endregion
# region: exports
box::export(vulnerability)

# endregion
