mtx_cor == unique(mtx_cor[!is.na(mtx_cor)])
# PACKAGES -----------------------------------------------------------------
pkg <- c(
# 'paletteer', 'ggthemes', 'scales' #Visualization
'readr', 'readxl','openxlsx' #Read and write utilities
, 'tidyverse', 'labelled' #Data wrangling
# , 'caret' #Variance filter
, 'psych' #Factor analysis
)
# Activate / install packages
lapply(pkg, function(x)
if(!require(x, character.only = T))
{install.packages(x); require(x)})
# Package citation
# lapply(pkg, function(x)
#   {citation(package = x)})
# WORKING DIRECTORY -------------------------------------------------------
setwd('C:/Users/Cao/Documents/Github/Atlas-Research/Career-Choice-Models')
# AUTO-EFA FUNCTIONS ----------------------------------------------------------------
source('./Auto_EFA.R')
# DATA --------------------------------------------------------------------
# Occupations data frame
df_occupations <- readr::read_csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vSphzWoCxoNaiaJcQUWKCMqUAT041Q8UqUgM7rSzIwYZb7FhttKJwNgtrFf-r7EgzXHFom4UjLl2ltk/pub?gid=563902602&single=true&output=csv')
# Labels character vector
chr_labels <- scan(
url('https://docs.google.com/spreadsheets/d/e/2PACX-1vSphzWoCxoNaiaJcQUWKCMqUAT041Q8UqUgM7rSzIwYZb7FhttKJwNgtrFf-r7EgzXHFom4UjLl2ltk/pub?gid=1223197022&single=true&output=csv')
, sep=','
, what = ''
, quiet = T
)
# Exploratory analyses
df_occupations %>% glimpse()
df_occupations %>% class()
df_occupations %>% head()
chr_labels %>% glimpse()
chr_labels %>% class()
chr_labels %>% head()
ncol(df_occupations) == length(chr_labels)
# Apply labels
df_occupations %>%
labelled::set_variable_labels(
.labels = chr_labels
) -> df_occupations
# Only numeric variables
df_occupations %>%
select(
where(function(x){str_detect(attributes(x)$label, '_Skill')}) #All Skills only
, -ends_with('.I') #Using recommended levels
# , -ends_with('.L') #Using importance levels
) %>%
mutate(#0 to 100 => 0 to 1 (helps calculate similarity later on)
across(
.fns = function(x){x/100}
)
) -> df_occupations.numeric.skill
# Only numeric variables
df_occupations %>%
select(
where(function(x){str_detect(attributes(x)$label, 'Abilities.')}) #Abilities only
, -ends_with('.I') #Using recommended levels
# , -ends_with('.L') #Using importance levels
) %>%
mutate(#0 to 100 => 0 to 1 (helps calculate similarity later on)
across(
.fns = function(x){x/100}
)
) -> df_occupations.numeric.ablt
# Only numeric variables
df_occupations %>%
select(
where(function(x){str_detect(attributes(x)$label, 'Knowledge.')}) #Knowledge only
, -ends_with('.I') #Using recommended levels
# , -ends_with('.L') #Using importance levels
) %>%
mutate(#0 to 100 => 0 to 1 (helps calculate similarity later on)
across(
.fns = function(x){x/100}
)
) -> df_occupations.numeric.know
# Only numeric variables
df_occupations %>%
select(
where(function(x){str_detect(attributes(x)$label, 'Work_Context.')}) #Work contexts only
, -ends_with('.I') #Using recommended levels
# , -ends_with('.L') #Using importance levels
) %>%
mutate(#0 to 100 => 0 to 1 (helps calculate similarity later on)
across(
.fns = function(x){x/100}
)
) -> df_occupations.numeric.context
# Only numeric variables
df_occupations %>%
select(
where(function(x){str_detect(attributes(x)$label, 'Work_Activities.')}) #Work activities only
, -ends_with('.I') #Using recommended levels
# , -ends_with('.L') #Using importance levels
) %>%
mutate(#0 to 100 => 0 to 1 (helps calculate similarity later on)
across(
.fns = function(x){x/100}
)
) -> df_occupations.numeric.activities
# ----- PARAMETERS -----------------------------------------------------------
# VARIANCE PROPORTIONALITY  ------------------------------------------------
df_occupations %>%
select(
colnames(
df_occupations.numeric.skill
)
, colnames(
df_occupations.numeric.ablt
)
, colnames(
df_occupations.numeric.know
)
, colnames(
df_occupations.numeric.context
)
, colnames(
df_occupations.numeric.activities
)
) %>%
mutate(#0 to 100 => 0 to 1 (helps calculate similarity later on)
across(
.fns = function(x){x/100}
)
) -> df_occupations.numeric
df_occupations.numeric %>%
summarise(
across(
.cols = everything()
,.fns = var
)
) %>%
rowSums() -> dbl_occupations.var.total
df_occupations.numeric.skill %>%
summarise(
across(
.cols = everything()
,.fns = var
)
) %>%
rowSums() -> dbl_skills.var.total
df_occupations.numeric.ablt %>%
summarise(
across(
.cols = everything()
,.fns = var
)
) %>%
rowSums() -> dbl_ablt.var.total
df_occupations.numeric.know %>%
summarise(
across(
.cols = everything()
,.fns = var
)
) %>%
rowSums() -> dbl_know.var.total
df_occupations.numeric.context %>%
summarise(
across(
.cols = everything()
,.fns = var
)
) %>%
rowSums() -> dbl_context.var.total
df_occupations.numeric.activities %>%
summarise(
across(
.cols = everything()
,.fns = var
)
) %>%
rowSums() -> dbl_activities.var.total
# Variance proportionality (how much each category contributes to total variance)
dbl_occupations.var.total
sum(
dbl_skills.var.total
, dbl_ablt.var.total
, dbl_know.var.total
, dbl_context.var.total
, dbl_activities.var.total
)
dbl_skills.var.pct <- dbl_skills.var.total / dbl_occupations.var.total
dbl_ablt.var.pct <- dbl_ablt.var.total / dbl_occupations.var.total
dbl_know.var.pct <- dbl_know.var.total / dbl_occupations.var.total
dbl_context.var.pct <- dbl_context.var.total / dbl_occupations.var.total
dbl_activities.var.pct <- dbl_activities.var.total / dbl_occupations.var.total
dbl_skills.var.pct %>% round(4)
dbl_ablt.var.pct %>% round(4)
dbl_know.var.pct %>% round(4)
dbl_context.var.pct %>% round(4)
dbl_activities.var.pct %>% round(4)
# Define number of items in the questionnaire
dbl_items.total <- 60
# Pick N items from each category in proportion to total variability
dbl_skills.items <- dbl_skills.var.pct * dbl_items.total
dbl_ablt.items <- dbl_ablt.var.pct * dbl_items.total
dbl_know.items <- dbl_know.var.pct * dbl_items.total
dbl_context.items <- dbl_context.var.pct * dbl_items.total
dbl_activities.items <- dbl_activities.var.pct * dbl_items.total
dbl_skills.items <- round(dbl_skills.items)
dbl_ablt.items <- round(dbl_ablt.items)
dbl_know.items <- round(dbl_know.items)
dbl_context.items <- round(dbl_context.items)
dbl_activities.items <- round(dbl_activities.items)
dbl_skills.items
dbl_ablt.items
dbl_know.items
dbl_context.items
dbl_activities.items
sum(
dbl_skills.items
, dbl_ablt.items
, dbl_know.items
, dbl_context.items
, dbl_activities.items
)
# ITEMS PER CATEGORY PARAMETERS 2 -------------------------------------------
# Manually define number of items
.int_n.items.total.skill <- 6
.int_n.items.total.ablt <- 9
.int_n.items.total.know <- 12
.int_n.items.total.context <- 21
.int_n.items.total.activities <- 12
6 + 9 + 12 + 12 + 21
# FACTOR ROTATIONS 2 ---------------------------------------------------------
.chr_rotation.skill <- 'varimax'
# .chr_rotation.skill <- 'promax'
.chr_rotation.ablt <- 'promax'
# .chr_rotation.know <- 'varimax'
.chr_rotation.know <- 'promax'
.chr_rotation.context <- 'varimax'
.chr_rotation.activities <- 'promax'
# GLOBAL EFA PARAMETERS 12 ---------------------------------------------------
# Number of factors
.auto_select.nfactors <- T
# Minimum factor size
.int_min.factor_size <- 3
.remove_unacceptable_MSAi.items <- T
# Underloadings and crossloadings
.remove_under_loading.items <- T
.remove_cross_loading.items <- F
.dbl_under_loading.threshold <- 0.5
.dbl_cross_loading.threshold <- 0.3
# Diagrams and tests
.show_diagrams <- T
.show_results <- T
# FULLY AUTOMATED EFA WORKFLOW (WITH TOP ITEMS) --------------------------------------------
# Skills
fun_best.model.top.items.workflow(
# Basic
.df_data.numeric = df_occupations.numeric.skill
, .auto_select.nfactors = .auto_select.nfactors
, .int_min.factor_size = .int_min.factor_size
, .int_n.items.total = .int_n.items.total.skill
, .chr_rotation = .chr_rotation.skill
, .remove_unacceptable_MSAi.items = .remove_unacceptable_MSAi.items
# Underloadings and crossloadings
, .remove_under_loading.items = .remove_under_loading.items
, .remove_cross_loading.items = .remove_cross_loading.items
, .dbl_under_loading.threshold = .dbl_under_loading.threshold
, .dbl_cross_loading.threshold = .dbl_cross_loading.threshold
# Diagrams and tests
, .show_diagrams = .show_diagrams
, .show_results = .show_results
) -> EFA_Skill
# Abilities
fun_best.model.top.items.workflow(
# Basic
.df_data.numeric = df_occupations.numeric.ablt
, .auto_select.nfactors = .auto_select.nfactors
, .int_min.factor_size = .int_min.factor_size
, .int_n.items.total = .int_n.items.total.ablt
, .chr_rotation = .chr_rotation.ablt
, .remove_unacceptable_MSAi.items = .remove_unacceptable_MSAi.items
# Underloadings and crossloadings
, .remove_under_loading.items = .remove_under_loading.items
, .remove_cross_loading.items = .remove_cross_loading.items
, .dbl_under_loading.threshold = .dbl_under_loading.threshold
, .dbl_cross_loading.threshold = .dbl_cross_loading.threshold
# Diagrams and tests
, .show_diagrams = .show_diagrams
, .show_results = .show_results
) -> EFA_Ablt
# Knowledge
fun_best.model.top.items.workflow(
# Basic
.df_data.numeric = df_occupations.numeric.know
, .auto_select.nfactors = .auto_select.nfactors
, .int_min.factor_size = .int_min.factor_size
, .int_n.items.total = .int_n.items.total.know
, .chr_rotation = .chr_rotation.know
, .remove_unacceptable_MSAi.items = .remove_unacceptable_MSAi.items
# Underloadings and crossloadings
, .remove_under_loading.items = .remove_under_loading.items
, .remove_cross_loading.items = .remove_cross_loading.items
, .dbl_under_loading.threshold = .dbl_under_loading.threshold
, .dbl_cross_loading.threshold = .dbl_cross_loading.threshold
# Diagrams and tests
, .show_diagrams = .show_diagrams
, .show_results = .show_results
) -> EFA_Know
# Work context
fun_best.model.top.items.workflow(
# Basic
.df_data.numeric = df_occupations.numeric.context
, .auto_select.nfactors = .auto_select.nfactors
, .int_min.factor_size = .int_min.factor_size
, .int_n.items.total = .int_n.items.total.context
, .chr_rotation = .chr_rotation.context
, .remove_unacceptable_MSAi.items = .remove_unacceptable_MSAi.items
# Underloadings and crossloadings
, .remove_under_loading.items = .remove_under_loading.items
, .remove_cross_loading.items = .remove_cross_loading.items
, .dbl_under_loading.threshold = .dbl_under_loading.threshold
, .dbl_cross_loading.threshold = .dbl_cross_loading.threshold
# Diagrams and tests
, .show_diagrams = .show_diagrams
, .show_results = .show_results
) -> EFA_Context
# Work activities
fun_best.model.top.items.workflow(
# Basic
.df_data.numeric = df_occupations.numeric.activities
, .auto_select.nfactors = .auto_select.nfactors
, .int_min.factor_size = .int_min.factor_size
, .int_n.items.total = .int_n.items.total.activities
, .chr_rotation = .chr_rotation.activities
, .remove_unacceptable_MSAi.items = .remove_unacceptable_MSAi.items
# Underloadings and crossloadings
, .remove_under_loading.items = .remove_under_loading.items
, .remove_cross_loading.items = .remove_cross_loading.items
, .dbl_under_loading.threshold = .dbl_under_loading.threshold
, .dbl_cross_loading.threshold = .dbl_cross_loading.threshold
# Diagrams and tests
, .show_diagrams = .show_diagrams
, .show_results = .show_results
) -> EFA_Activities
View(df_occupations.numeric.context)
View(df_occupations.numeric.context)
EFA_Activities
# ----- EVALUATION --------------------------------------------------------
# COMPARING ONE STAGE WITH TWO STAGE EFA --------------------------------
# Skills
EFA_Skill$best.model$EFA.top.items$reliability.evaluation
EFA_Skill$best.models.evaluation %>% view()
EFA_Skill.1$best.models.evaluation %>% view()
EFA_Skill$all.models.evaluation %>% view()
EFA_Skill$EFA.workflow$EFA.top.items$EFA.2Factors$reliability.evaluation %>% view()
# Abilities
EFA_Ablt$best.model$EFA.top.items$reliability.evaluation
EFA_Ablt$best.models.evaluation %>% view()
EFA_Ablt$all.models.evaluation %>% view()
EFA_Ablt$best.model$EFA.top.items$reliability.evaluation %>% view()
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.2Factors$reliability.evaluation %>% view()
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.3Factors$reliability.evaluation %>% view()
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.4Factors$reliability.evaluation %>% view()
# Fields of Knowledge
EFA_Know$best.model$EFA.top.items$reliability.evaluation
EFA_Know$best.models.evaluation %>% view()
EFA_Know$all.models.evaluation %>% view()
EFA_Know$EFA.workflow$EFA.top.items$EFA.2Factors$reliability.evaluation %>% view()
EFA_Know$EFA.workflow$EFA.top.items$EFA.3Factors$reliability.evaluation %>% view()
EFA_Know$EFA.workflow$EFA.top.items$EFA.4Factors$reliability.evaluation %>% view()
EFA_Know$EFA.workflow$EFA.top.items$EFA.5Factors$reliability.evaluation %>% view()
# Work context
EFA_Context$best.model$EFA.top.items$reliability.evaluation
EFA_Context$best.models.evaluation %>% view()
EFA_Context$best.models.evaluation %>% view()
EFA_Context$all.models.evaluation %>% view()
EFA_Context$all.models.evaluation %>% view()
EFA_Context$EFA.workflow$EFA.top.items$EFA.2Factors$reliability.evaluation %>% view()
EFA_Context$EFA.workflow$EFA.top.items$EFA.3Factors$reliability.evaluation %>% view()
# Work activities
EFA_Activities$best.model$EFA.top.items$reliability.evaluation
EFA_Activities$best.models.evaluation %>% view()
EFA_Activities.1$best.models.evaluation %>% view()
EFA_Activities$all.models.evaluation %>% view()
EFA_Activities$EFA.workflow$EFA.top.items$EFA.2Factors$reliability.evaluation %>% view()
EFA_Activities$EFA.workflow$EFA.top.items$EFA.3Factors$reliability.evaluation %>% view()
# FACTOR ADEQUACY TESTS --------------------------------
# Skills
EFA_Skill$best.model$EFA.top.items$adequacy.tests
EFA_Skill$EFA.workflow$EFA.top.items$EFA.2Factors$adequacy.tests
# Abilities
EFA_Ablt$best.model$EFA.top.items$adequacy.tests
EFA_Ablt$best.model$EFA.top.items$adequacy.tests
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.2Factors$adequacy.tests
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.3Factors$adequacy.tests
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.4Factors$adequacy.tests
# Fields of Knowledge
EFA_Know$best.model$EFA.top.items$adequacy.tests
EFA_Know$EFA.workflow$EFA.top.items$EFA.2Factors$adequacy.tests
EFA_Know$EFA.workflow$EFA.top.items$EFA.3Factors$adequacy.tests
EFA_Know$EFA.workflow$EFA.top.items$EFA.4Factors$adequacy.tests
# Work context
EFA_Context$best.model$EFA.top.items$adequacy.tests
.chr_rotation.know
.dbl_cross_loading.threshold
.dbl_cross_loading.threshold
.dbl_under_loading.threshold
# Work context
EFA_Context$best.model$EFA.top.items$adequacy.tests
EFA_Context$EFA.workflow$EFA.top.items$EFA.2Factors$adequacy.tests
EFA_Context$EFA.workflow$EFA.top.items$EFA.3Factors$adequacy.tests
# Work activities
EFA_Activities$best.model$EFA.top.items$adequacy.tests
EFA_Activities$EFA.workflow$EFA.top.items$EFA.2Factors$adequacy.tests
EFA_Activities$EFA.workflow$EFA.top.items$EFA.3Factors$adequacy.tests
# FACTOR CORRELATION AND REDUNDANCY --------------------------------
# Skills
EFA_Skill$best.model$EFA.top.items$factor.correlation
# Abilities
EFA_Ablt$best.model$EFA.top.items$factor.correlation
EFA_Ablt$best.model$EFA.top.items$factor.correlation
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.2Factors$factor.correlation
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.3Factors$factor.correlation
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.4Factors$factor.correlation
# Fields of Knowledge
EFA_Know$best.model$EFA.top.items$factor.correlation
EFA_Know$EFA.workflow$EFA.top.items$EFA.2Factors$factor.correlation
EFA_Know$EFA.workflow$EFA.top.items$EFA.3Factors$factor.correlation
EFA_Know$EFA.workflow$EFA.top.items$EFA.4Factors$factor.correlation
# Work context
EFA_Context$best.model$EFA.top.items$factor.correlation
EFA_Context$EFA.workflow$EFA.top.items$EFA.2Factors$factor.correlation
EFA_Context$EFA.workflow$EFA.top.items$EFA.3Factors$factor.correlation
# Work activities
EFA_Activities$best.model$EFA.top.items$factor.correlation
EFA_Activities$EFA.workflow$EFA.top.items$EFA.2Factors$factor.correlation
EFA_Activities$EFA.workflow$EFA.top.items$EFA.3Factors$factor.correlation
# SUGGESTED ROTATION --------------------------------
# Skills
EFA_Skill$best.model$EFA.top.items$suggested.rotation
EFA_Skill$EFA.workflow$EFA.top.items$EFA.2Factors$suggested.rotation
# Abilities
EFA_Ablt$best.model$EFA.top.items$suggested.rotation
EFA_Ablt$best.model$EFA.top.items$suggested.rotation
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.2Factors$suggested.rotation
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.3Factors$suggested.rotation
EFA_Ablt$EFA.workflow$EFA.top.items$EFA.4Factors$suggested.rotation
# Fields of Knowledge
EFA_Know$best.model$EFA.top.items$suggested.rotation
EFA_Know$EFA.workflow$EFA.top.items$EFA.2Factors$suggested.rotation
EFA_Know$EFA.workflow$EFA.top.items$EFA.3Factors$suggested.rotation
EFA_Know$EFA.workflow$EFA.top.items$EFA.4Factors$suggested.rotation
# Work context
EFA_Context$best.model$EFA.top.items$suggested.rotation
EFA_Context$EFA.workflow$EFA.top.items$EFA.2Factors$suggested.rotation
EFA_Context$EFA.workflow$EFA.top.items$EFA.3Factors$suggested.rotation
# Work activities
EFA_Activities$best.model$EFA.top.items$suggested.rotation
EFA_Activities.1$best.model$suggested.rotation
EFA_Activities$EFA.workflow$EFA.top.items$EFA.2Factors$suggested.rotation
EFA_Activities$EFA.workflow$EFA.top.items$EFA.3Factors$suggested.rotation
# TOP ITEMS ---------------------------------------------------------------
# Skills
# EFA_Skill$best.model$top.items %>% view()
EFA_Skill$EFA.workflow$top.items$EFA.2Factors %>% view()
# Abilities
# EFA_Ablt$best.model$top.items %>% view()
# EFA_Ablt$EFA.workflow$top.items$EFA.2Factors %>% view()
EFA_Ablt$EFA.workflow$top.items$EFA.3Factors %>% view()
EFA_Ablt$EFA.workflow$top.items$EFA.4Factors %>% view()
# Abilities
# EFA_Ablt$best.model$top.items %>% view()
# EFA_Ablt$EFA.workflow$top.items$EFA.2Factors %>% view()
EFA_Ablt$EFA.workflow$top.items$EFA.3Factors %>% view()
EFA_Know$EFA.workflow$top.items$EFA.2Factors %>% view()
EFA_Know$EFA.workflow$top.items$EFA.3Factors %>% view()
EFA_Know$EFA.workflow$top.items$EFA.4Factors %>% view()
EFA_Know$EFA.workflow$top.items$EFA.5Factors %>% view()
# Work context
# EFA_Context$best.model$top.items %>% view()
EFA_Context$EFA.workflow$top.items$EFA.3Factors %>% view()
# Work activities
# EFA_Activities$EFA.workflow$top.items$EFA.2Factors %>% view()
EFA_Activities$EFA.workflow$top.items$EFA.3Factors %>% view()
# TOP ITEMS ---------------------------------------------------------------
# Skills
# EFA_Skill$best.model$top.items %>% view()
EFA_Skill$EFA.workflow$top.items$EFA.2Factors %>% view()
# Abilities
# EFA_Ablt$best.model$top.items %>% view()
# EFA_Ablt$EFA.workflow$top.items$EFA.2Factors %>% view()
EFA_Ablt$EFA.workflow$top.items$EFA.3Factors %>% view()
EFA_Ablt$EFA.workflow$top.items$EFA.4Factors %>% view()
EFA_Know$EFA.workflow$top.items$EFA.2Factors %>% view()
EFA_Know$EFA.workflow$top.items$EFA.3Factors %>% view()
EFA_Know$EFA.workflow$top.items$EFA.4Factors %>% view()
EFA_Know$EFA.workflow$top.items$EFA.5Factors %>% view()
# Work context
# EFA_Context$best.model$top.items %>% view()
EFA_Context$EFA.workflow$top.items$EFA.3Factors %>% view()
round(0.699,2)
round(0.699,3)
round(0.35,2)
round(0.36,2)
round(0.37,2)
round(0.68,2)
round(0.69,2)
round(0.698,2)
round(0.67,2)
round(0.355,2)
round(0.688,2)
round(0.689,2)
round(0.695,2)
round(0.694,2)
round(0.695,2)
