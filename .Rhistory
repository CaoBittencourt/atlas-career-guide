# -------- SETUP -----------------------------------------------------------
# PACKAGES ----------------------------------------------------------------
pkg <- c(
'ggthemes', 'ggridges', 'gghighlight', 'scales' , 'viridis', 'ggalt'
# , 'ComplexHeatmap'
, 'circlize' #'paletteer' #Data visualization
, 'devtools' #Dev Tools
# , 'ggalt', 'hrbrthemes', 'extrafont' #Data visualization
# , 'ggthemr' #Data visualization
, 'tidyverse', 'rlang' #Data wrangling
)
# Activate / install packages
lapply(pkg, function(x)
if(!require(x, character.only = T))
{install.packages(x); require(x)})
install_github('jokergoo/ComplexHeatmap')
# install_github('jokergoo/circlize')
library(ComplexHeatmap)
# Package citation
# lapply(pkg, function(x)
#   {citation(package = x)})
# WORKING DIRECTORY -------------------------------------------------------
setwd('C:/Users/Cao/Documents/Github/Atlas-Research')
# # [TO DO] FONTS -------------------------------------------------------------------
# font_import(prompt = F)
# loadfonts(device = 'win')
# hrbrthemes::
# hrbrthemes::import_roboto_condensed()
# -------- DATA -----------------------------------------------------------
# OCCUPATIONS DATA FRAME -------------------------------------------
# Occupations data frame
df_occupations <- readr::read_csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vSphzWoCxoNaiaJcQUWKCMqUAT041Q8UqUgM7rSzIwYZb7FhttKJwNgtrFf-r7EgzXHFom4UjLl2ltk/pub?gid=563902602&single=true&output=csv')
# Select only necessary variables
df_occupations %>%
select(
# occupation,
ends_with('.l')
) %>%
mutate(
across(
.cols = ends_with('.l')
, .fns = function(x){x/100}
)
) -> df_occupations
# # Sample to speed testing
# df_occupations %>%
#   sample_n(30) -> df_occupations
# REORDER ROWS AND COLS TO LOOK LIKE ATLAS LOGO ---------------------------
# Cols
df_occupations %>%
colSums() %>%
sort(decreasing = T) %>%
names() -> chr_cols.sort
# # Rows
# df_occupations %>%
#   rowSums() %>%
#   as_tibble() %>%
#   mutate(index = row_number()) %>%
#   arrange(desc(value)) %>%
#   pull(index) -> int_rows.index
# Reorder
# df_occupations[int_rows.index, chr_cols.sort] -> df_occupations
# df_occupations[, chr_cols.sort] -> df_occupations
df_occupations[, chr_cols.sort] %>%
# arrange(across(everything(), desc)) -> df_occupations
# arrange(across(everything())) -> df_occupations
arrange(across(
head(
names(.)
, round(ncol(.) / 3)
))) -> df_occupations
# CONVERT TO MATRIX --------------------------------------------------------------------
# Convert to matrix
df_occupations %>%
select(ends_with('.l')) %>%
as.matrix() -> mtx_occupations
# -------- PLOT ELEMENTS ---------------------------------------------------
# TRACK HEIGHT ------------------------------------------------------------
# int_track.size <- 0.125
# int_track.size <- 0.25
int_track.size <- 0.2
# int_track.size <- 0.5
# LIST OF COLORS ------------------------------------------------------------------
colorRamp2(
# c(0, 1)
# c(0.3, 1)
c(0.3, 0.7)
# c(0, 0.7)
, c(
'#753AF9'
, '#4AF7B0'
)
) -> fun_colors
# -------- PLOTS -----------------------------------------------------------
# ATLAS LOGO HEATMAP --------------------------------------------------------------------
circos.clear()
circos.par(
# start.degree = - (45 + 90)
start.degree = 180
# start.degree = - 120
# start.degree = - 90
, gap.degree = 0
)
png(
'Logo_Heatmap.png'
, type = 'cairo'
, bg = 'transparent'
# , width = 1920
, width = 500 #465
, height = 500 #225
# , width = 1080
# , height = 1080
# , units = 'px'
, units = 'mm'
, res = 1500
)
# pdf(
#   'Logo_Heatmap.pdf'
#   , bg = 'transparent'
#   # , width = 1920
#   , width = 500
#   , height = 500
# )
# Circular heatmap
circos.heatmap(
mat = mtx_occupations
, col = fun_colors
, track.height = int_track.size
, split = seq(1, nrow(mtx_occupations))
# , rownames.side = 'outside'
# , cell.border = '#FFFFFF'
# , cell.border = '#212121'
# , bg.border = '#212121'
# , bg.lwd = 2.23
# , cell.border = '#212121'
# , cell.lwd = 1
# , cell.lwd = 2.23
# , cell.lwd = .125
# , cell.lwd = .0625
, cluster = F
)
dev.off()
# -------- SETUP -----------------------------------------------------------
# PACKAGES ----------------------------------------------------------------
pkg <- c(
'ggthemes', 'ggridges', 'gghighlight', 'scales' , 'viridis', 'ggalt'
# , 'ComplexHeatmap'
, 'circlize' #'paletteer' #Data visualization
, 'devtools' #Dev Tools
# , 'ggalt', 'hrbrthemes', 'extrafont' #Data visualization
# , 'ggthemr' #Data visualization
, 'tidyverse', 'rlang' #Data wrangling
)
# Activate / install packages
lapply(pkg, function(x)
if(!require(x, character.only = T))
{install.packages(x); require(x)})
install_github('jokergoo/ComplexHeatmap')
# install_github('jokergoo/circlize')
library(ComplexHeatmap)
# Package citation
# lapply(pkg, function(x)
#   {citation(package = x)})
# WORKING DIRECTORY -------------------------------------------------------
setwd('C:/Users/Cao/Documents/Github/Atlas-Research')
# # [TO DO] FONTS -------------------------------------------------------------------
# font_import(prompt = F)
# loadfonts(device = 'win')
# hrbrthemes::
# hrbrthemes::import_roboto_condensed()
# -------- DATA -----------------------------------------------------------
# OCCUPATIONS DATA FRAME -------------------------------------------
# Occupations data frame
df_occupations <- readr::read_csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vSphzWoCxoNaiaJcQUWKCMqUAT041Q8UqUgM7rSzIwYZb7FhttKJwNgtrFf-r7EgzXHFom4UjLl2ltk/pub?gid=563902602&single=true&output=csv')
# Select only necessary variables
df_occupations %>%
select(
# occupation,
ends_with('.l')
) %>%
mutate(
across(
.cols = ends_with('.l')
, .fns = function(x){x/100}
)
) -> df_occupations
# # Sample to speed testing
# df_occupations %>%
#   sample_n(30) -> df_occupations
# REORDER ROWS AND COLS TO LOOK LIKE ATLAS LOGO ---------------------------
# Cols
df_occupations %>%
colSums() %>%
sort(decreasing = T) %>%
names() -> chr_cols.sort
# # Rows
# df_occupations %>%
#   rowSums() %>%
#   as_tibble() %>%
#   mutate(index = row_number()) %>%
#   arrange(desc(value)) %>%
#   pull(index) -> int_rows.index
# Reorder
# df_occupations[int_rows.index, chr_cols.sort] -> df_occupations
# df_occupations[, chr_cols.sort] -> df_occupations
df_occupations[, chr_cols.sort] %>%
# arrange(across(everything(), desc)) -> df_occupations
# arrange(across(everything())) -> df_occupations
arrange(across(
head(
names(.)
, round(ncol(.) / 3)
))) -> df_occupations
# CONVERT TO MATRIX --------------------------------------------------------------------
# Convert to matrix
df_occupations %>%
select(ends_with('.l')) %>%
as.matrix() -> mtx_occupations
# -------- PLOT ELEMENTS ---------------------------------------------------
# TRACK HEIGHT ------------------------------------------------------------
# int_track.size <- 0.125
# int_track.size <- 0.25
int_track.size <- 0.2
# int_track.size <- 0.5
# LIST OF COLORS ------------------------------------------------------------------
colorRamp2(
# c(0, 1)
# c(0.3, 1)
c(0.3, 0.7)
# c(0, 0.7)
, c(
'#753AF9'
, '#4AF7B0'
)
) -> fun_colors
# -------- PLOTS -----------------------------------------------------------
# ATLAS LOGO HEATMAP --------------------------------------------------------------------
circos.clear()
circos.par(
# start.degree = - (45 + 90)
start.degree = 180
# start.degree = - 120
# start.degree = - 90
, gap.degree = 0
)
png(
'Logo_Heatmap.png'
, type = 'cairo'
, bg = 'transparent'
# , width = 1920
, width = 500 #465
, height = 500 #225
# , width = 1080
# , height = 1080
# , units = 'px'
, units = 'mm'
, res = 1500
)
# pdf(
#   'Logo_Heatmap.pdf'
#   , bg = 'transparent'
#   # , width = 1920
#   , width = 500
#   , height = 500
# )
# Circular heatmap
circos.heatmap(
mat = mtx_occupations
, col = fun_colors
, track.height = int_track.size
# , split = seq(1, nrow(mtx_occupations))
# , rownames.side = 'outside'
# , cell.border = '#FFFFFF'
# , cell.border = '#212121'
# , bg.border = '#212121'
# , bg.lwd = 2.23
# , cell.border = '#212121'
# , cell.lwd = 1
# , cell.lwd = 2.23
# , cell.lwd = .125
# , cell.lwd = .0625
, cluster = F
)
dev.off()
